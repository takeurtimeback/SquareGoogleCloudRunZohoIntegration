https://accounts.zoho.com/oauth/v2/auth?
scope=ZohoBooks.fullaccess.all
&client_id=1000.FHO5MNQV9XIH68Y1K1L0O5O7G9YSLQ
&response_type=code
&access_type=offline
&redirect_uri=https://example.com/oauth/callback

https://example.com/oauth/callback?code=1000.cbdcb158436ec78ae91c71a443fa7b8c.221405dc779c33501504b45f4af48532&location=ca&accounts-server=https%3A%2F%2Faccounts.zohocloud.ca

1000.c9f812ec4956030f0d9cc97e14fb59ac.1090a1632f20bf01100c0c6e198303bd



curl.exe -X POST "https://accounts.zohocloud.ca/oauth/v2/token" -H "Content-Type: application/x-www-form-urlencoded" -d "client_id=1000.FFWK1GZAWERDY5LPOP09T2BATX0BQJ&client_secret=8f033198a9c5a4ab49e94c0c49ee8c9662ae93fa48&grant_type=authorization_code&code=1000.99a7e184b48c238b42019c4445ccca51.62439fd85aeeedcb27a39b46e99db90f&redirect_uri=http://localhost:3000/oauth/callback"

{"access_token":"1000.83d1dd8a456af4f3b3d5117649050e7e.245c07c86a283fce40a26d564ae4711c","refresh_token":"1000.69253ba57a70078e371cecac85e36fe8.54c4ecfb3d5df22ab5f014346adc0e47","scope":"ZohoBooks.fullaccess.all","api_domain":"https://www.zohoapis.ca","token_type":"Bearer","expires_in":3600}


https://connect.squareup.com/v2/orders/${webhookTrigger.payload.data.object.order_created.order_id} request for square order


if payout cost:

int CalculatePayout(string OrderDat)
{
totalPayout = 0.00;
// Get the order object
responseMap = OrderDat.toMap();
orderMap = input.responseMap.get("order");
// Parse line_items (STRING → LIST)
lineItemsString = orderMap.get("line_items");
lineItemsList = lineItemsString.toList();
// Prepare output line items list
outputLineItems = List();
// Loop through each line item
for each  item in lineItemsList
{
	itemMap = item.toMap();
	quantity = itemMap.get("quantity").toLong();
	name = itemMap.get("name");
	payout = 0.00;
	if(name == "SoundPayout")
	{
		payout = 50 * quantity;
		info "added SoundPayout x";
		info quantity;
	}
	if(name == "DoorPayout")
	{
		payout = 20 * quantity;
		info "added doorPayout x";
		info quantity;
	}
	totalPayout = totalPayout + payout;
}
info "totalPayout is";
info totalPayout;
totalPayout = round(totalPayout,2);
return totalPayout;
}

if artist payout(contians  ticket):
Fetch row
Function 

update row:
float CalculateNewArtistPayout(string OrderDat, float PreviousAmount)
{
totalPayout = PreviousAmount;
// Get the order object
responseMap = OrderDat.toMap();
orderMap = input.responseMap.get("order");
// Parse line_items (STRING → LIST)
lineItemsString = orderMap.get("line_items");
lineItemsList = lineItemsString.toList();
// Prepare output line items list
outputLineItems = List();
// Loop through each line item
for each  item in lineItemsList
{
	itemMap = item.toMap();
	quantity = itemMap.get("quantity").toLong();
	name = itemMap.get("name");
	basePriceMoney = itemMap.get("base_price_money");
	rate = basePriceMoney.get("amount") / 100.0;
	payout = 0.00;
	if(name == "Ticket")
	{
		payout = rate * quantity * 0.6;
		info "added Ticket at" + rate + " " + quantity + "times";
	}
	totalPayout = totalPayout + payout;
}
info "totalPayout is";
info totalPayout;
totalPayout = round(totalPayout,2);
return totalPayout;
}


Is square fee(CREDIT OR DEBIT)
Fetch row
function:
float UpdateSquareFees1(string OrderDat, string Amount)
{
info Amount;
fetchedFeeTotal = Amount.toDecimal();
// Get the order object
responseMap = OrderDat.toMap();
orderMap = input.responseMap.get("order");
// Get tenders as STRING
tendersString = orderMap.get("tenders");
// Parse the JSON string into a List
tendersList = tendersString.toList();
// Get first tender (usually only one)
firstTender = tendersList.get(0);
// Get amount_money map
amountMoney = firstTender.get("amount_money");
// Extract amount (this is usually an integer in cents)
amountValue = amountMoney.get("amount");
// Convert to float
amountFloat = amountValue.toDecimal();
// OPTIONAL: Convert from cents to dollars (Square uses cents)
amountFloat = amountFloat / 100;
// Extract card type
cardDetails = firstTender.get("card_details");
card = cardDetails.get("card");
cardType = card.get("card_type");
// CREDIT or DEBIT
// Calculate fee based on card type
fee = 0.0;
if(cardType == "CREDIT")
{
	fee = amountFloat * 0.025;
}
else if(cardType == "DEBIT")
{
	fee = amountFloat * 0.0075 + .07;
}
// Add 7
finalAmount = fee;
finalAmount = round(finalAmount,2);
// Log results
info "Card Type: " + cardType;
info "Transaction Amount: " + amountFloat;
info "Calculated Fee: " + fee;
info "Final Amount: " + finalAmount;
// amountFloat now contains the payment amount as a float
finalAmount = fetchedFeeTotal + finalAmount;
return finalAmount;
}
greater than 0
update row

parse Order Data:
string parseOrderData(string OrderData)
{
// Get order object
responseMap = OrderData.toMap();
orderMap = responseMap.get("order");
// Parse line_items (STRING → LIST)
lineItemsString = orderMap.get("line_items");
lineItemsList = lineItemsString.toList();
// Prepare output line items list
outputLineItems = List();
// Loop through each line item
for each  item in lineItemsList
{
	itemMap = item.toMap();
	name = itemMap.get("name");
	quantity = itemMap.get("quantity").toLong();
	// Base price is in cents
	basePriceMoney = itemMap.get("base_price_money");
	rate = basePriceMoney.get("amount") / 100.0;
	lineItem = Map();
	lineItem.put("name",name);
	lineItem.put("quantity",quantity);
	lineItem.put("rate",rate);
	outputLineItems.add(lineItem);
}
// Build final response map
finalResponse = Map();
finalResponse.put("customer_name","test");
finalResponse.put("payment_method","cash");
finalResponse.put("line_items",outputLineItems);
// Return JSON string
return finalResponse.toString();
}
webhook sales recipt
https://www.zohoapis.ca/books/v3/salesreceipts?organization_id=110002141516


parse order data output: {
   parseOrderData_2 : "{"customer_name":"test","payment_method":"cash","line_items":[{"name":"Beer","quantity":1,"rate":5.13}]}"
}

square webhook output:{
   response : {
      order : {
         total_tax_money : {
            amount : 0,
            currency : "CAD"
         },
         closed_at : "2025-12-17T05:34:59.748Z",
         total_service_charge_money : {
            amount : 0,
            currency : "CAD"
         },
         total_tip_money : {
            amount : 0,
            currency : "CAD"
         },
         created_at : "2025-12-17T05:34:58.146Z",
         line_items : [
            {
               catalog_version : 1765943936785,
               catalog_object_id : "HEUIO3LOWBIQGXVS55SF6CQE",
               quantity : "1",
               total_tax_money : {
                  amount : 0,
                  currency : "CAD"
               },
               variation_name : "Regular",
               item_type : "ITEM",
               total_service_charge_money : {
                  amount : 0,
                  currency : "CAD"
               },
               gross_sales_money : {
                  amount : 513,
                  currency : "CAD"
               },
               total_card_surcharge_money : {
                  amount : 0,
                  currency : "CAD"
               },
               uid : "a0345e2d-86c1-4d66-ad98-32a51fc2ff03",
               variation_total_price_money : {
                  amount : 513,
                  currency : "CAD"
               },
               base_price_money : {
                  amount : 513,
                  currency : "CAD"
               },
               name : "Beer",
               total_discount_money : {
                  amount : 0,
                  currency : "CAD"
               },
               total_money : {
                  amount : 513,
                  currency : "CAD"
               }
            }
         ],
         source : {

         },
         version : 5,
         location_id : "LNAA22MEM4S2W",
         total_card_surcharge_money : {
            amount : 0,
            currency : "CAD"
         },
         updated_at : "2025-12-17T05:35:01.000Z",
         tenders : [
            {
               transaction_id : "5AgW6XPTRnzCMyvYQBTLVczKs2aZY",
               card_details : {
                  entry_method : "CONTACTLESS",
                  card : {
                     last_4 : "8388",
                     bin : "472409",
                     card_brand : "INTERAC",
                     fingerprint : "sq-1-lEII-VrAfWy9fJygI-Omq4MDuzfQVV_KNRov941ca7S_iQxygNWH37ArhK2oT25P8g",
                     exp_month : 8,
                     prepaid_type : "NOT_PREPAID",
                     exp_year : 2028,
                     card_type : "DEBIT"
                  },
                  status : "CAPTURED"
               },
               payment_id : "dEvYregSSb37LraR4Tqlln85d0SZY",
               created_at : "2025-12-17T05:34:58Z",
               amount_money : {
                  amount : 513,
                  currency : "CAD"
               },
               id : "dEvYregSSb37LraR4Tqlln85d0SZY",
               type : "CARD",
               location_id : "LNAA22MEM4S2W"
            }
         ],
         net_amount_due_money : {
            amount : 0,
            currency : "CAD"
         },
         total_discount_money : {
            amount : 0,
            currency : "CAD"
         },
         net_amounts : {
            discount_money : {
               amount : 0,
               currency : "CAD"
            },
            card_surcharge_money : {
               amount : 0,
               currency : "CAD"
            },
            tip_money : {
               amount : 0,
               currency : "CAD"
            },
            total_money : {
               amount : 513,
               currency : "CAD"
            },
            service_charge_money : {
               amount : 0,
               currency : "CAD"
            },
            tax_money : {
               amount : 0,
               currency : "CAD"
            }
         },
         id : "5AgW6XPTRnzCMyvYQBTLVczKs2aZY",
         state : "COMPLETED",
         total_money : {
            amount : 513,
            currency : "CAD"
         }
      }
   },
   status : 200
}






example from status app.post("/webhook", async (req, res) => {
  try {
    const orderId = extractOrderId(req.body);

    if (!orderId) {
      return res.status(400).send("Order ID not found");
    }

    const squareOrder = await fetchSquareOrder(
      orderId,
      process.env.SQUARE_ACCESS_TOKEN
    );

    console.log("Square Order:", JSON.stringify(squareOrder, null, 2));

    res.status(200).json({ success: true });

  } catch (err) {
    console.error(
      "Square API error:",
      err.response?.data || err.message
    );
    res.status(500).send("Failed to fetch Square order");
  }
});






